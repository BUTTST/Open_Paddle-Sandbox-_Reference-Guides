# å¸¸è¦‹å•é¡Œèˆ‡é™¤éŒ¯æŒ‡å—

> æœ¬æ–‡æª”æ•´ç†äº†ä½¿ç”¨ Paddle Billing v2 æ™‚æœ€å¸¸é‡åˆ°çš„å•é¡Œèˆ‡è§£æ±ºæ–¹æ³•

---

## âš ï¸ æ–‡æª”å…è²¬è²æ˜

**æœ¬æŒ‡å—å…¨æ–‡ç”± AI ç”Ÿæˆï¼Œã€Œç„¡äººå·¥å¯©é–±ã€  
é›–ç„¶å·²ç›¡åŠ›ç¢ºä¿æº–ç¢ºæ€§ï¼Œä½†ä»å¯èƒ½å­˜åœ¨åå·®æˆ–éŒ¯èª¤ï¼Œ  
è«‹è‡ªè¡Œé©—è­‰ä¸¦ä»¥å¯¦éš›æ“ä½œçµæœç‚ºæº–ã€‚**

---

## ğŸ“‹ ç›®éŒ„
1. [å‰ç«¯çµå¸³å•é¡Œ](#1%EF%B8%8Fâƒ£-å‰ç«¯çµå¸³å•é¡Œ)
2. [HTTP éŒ¯èª¤ç¢¼å•é¡Œ](#2%EF%B8%8Fâƒ£-http-éŒ¯èª¤ç¢¼å•é¡Œ)
3. [Webhook å•é¡Œ](#3%EF%B8%8Fâƒ£-webhook-å•é¡Œ)
4. [ç’°å¢ƒåˆ‡æ›å•é¡Œ](#4%EF%B8%8Fâƒ£-ç’°å¢ƒåˆ‡æ›å•é¡Œ)
5. [ä»˜æ¬¾å¤±æ•—å•é¡Œ](#5%EF%B8%8Fâƒ£-ä»˜æ¬¾å¤±æ•—å•é¡Œ)
6. [é™¤éŒ¯å·¥å…·èˆ‡æŠ€å·§](#6%EF%B8%8Fâƒ£-é™¤éŒ¯å·¥å…·èˆ‡æŠ€å·§)

---

## 1ï¸âƒ£ å‰ç«¯çµå¸³å•é¡Œ

### Q1ï¼šé»æ“ŠæŒ‰éˆ•æ²’æœ‰åæ‡‰

**ç—‡ç‹€**ï¼š
- é»æ“Šã€ŒBuy my productã€æŒ‰éˆ•å¾Œæ²’æœ‰ä»»ä½•åæ‡‰
- Paddle Overlay æ²’æœ‰å½ˆå‡º

**å¯èƒ½åŸå› **ï¼š
- Paddle è…³æœ¬å°šæœªè¼‰å…¥å®Œæˆ
- Price ID æœªæ­£ç¢ºè¨­ç½®
- JavaScript åŸ·è¡ŒéŒ¯èª¤

**è§£æ±ºæ–¹æ³•**ï¼š

1. **é–‹å•Ÿç€è¦½å™¨é–‹ç™¼è€…å·¥å…·**ï¼š
   - Windows / Linuxï¼šæŒ‰ `F12`
   - macOSï¼šæŒ‰ `Cmd + Option + I`

2. **åˆ‡æ›åˆ° Consoleï¼ˆæ§åˆ¶å°ï¼‰åˆ†é **

3. **æŸ¥çœ‹æ˜¯å¦æœ‰ç´…è‰²éŒ¯èª¤è¨Šæ¯**

4. **åœ¨ Console è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤æª¢æŸ¥ Paddle ç‰©ä»¶**ï¼š
   ```javascript
   window.Paddle
   ```
   - å¦‚æœé¡¯ç¤º `undefined`ï¼Œè¡¨ç¤º Paddle è…³æœ¬æœªè¼‰å…¥

5. **æª¢æŸ¥ Price ID æ˜¯å¦æ­£ç¢º**ï¼š
   ```typescript
   // app/page.tsx
   const PRICE_ID = 'pri_...';  // å¿…é ˆæ˜¯æœ‰æ•ˆçš„ Price ID
   ```

6. **ç¢ºèª Paddle åˆå§‹åŒ–ç¨‹å¼ç¢¼**ï¼š
   ```typescript
   // components/PaddleLoader.tsx
   Paddle.Initialize({ token: 'ä½ çš„Token' });
   ```

---

### Q2ï¼šOverlay é¡¯ç¤ºã€ŒSomething went wrongã€

**ç—‡ç‹€**ï¼š
- Paddle çµå¸³è¦–çª—æœ‰å½ˆå‡º
- ä½†é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ã€ŒSomething went wrongã€

**å¯èƒ½åŸå› **ï¼š
- Token æœªæ­£ç¢ºè¨­ç½®
- Price ID ä¸å­˜åœ¨æˆ–ç„¡æ•ˆ
- ç’°å¢ƒè¨­å®šéŒ¯èª¤ï¼ˆSandbox vs Productionï¼‰

**è§£æ±ºæ–¹æ³•**ï¼š

1. **æª¢æŸ¥ Network æ¨™ç±¤**ï¼š
   - F12 â†’ Network
   - æ‰¾åˆ°å¤±æ•—çš„è«‹æ±‚ï¼ˆé€šå¸¸æ˜¯ç´…è‰²ï¼‰
   - é»æ“ŠæŸ¥çœ‹ Response

2. **å¸¸è¦‹éŒ¯èª¤è¨Šæ¯**ï¼š

| éŒ¯èª¤è¨Šæ¯ | åŸå›  | è§£æ±ºæ–¹æ³• |
|---------|------|---------|
| `paddle-clienttoken header is missing` | Token æœªæ­£ç¢ºåˆå§‹åŒ– | æª¢æŸ¥ `Paddle.Initialize({ token: '...' })` |
| `Price not found` | Price ID ä¸å­˜åœ¨ | ç¢ºèª Price ID æ­£ç¢ºä¸”å·²å»ºç«‹ |
| `Invalid environment` | ç’°å¢ƒä¸åŒ¹é… | æª¢æŸ¥æ˜¯å¦ç”¨ Sandbox Token è¨ªå• Production Price |

3. **ç¢ºèªç’°å¢ƒåŒ¹é…**ï¼š
   - Sandbox Tokenï¼ˆ`test_`ï¼‰ + Sandbox Price IDï¼ˆ`pri_...`ï¼‰
   - Production Tokenï¼ˆ`live_`ï¼‰ + Production Price IDï¼ˆ`pri_...`ï¼‰

---

### Q3ï¼šçµå¸³è¦–çª—èªè¨€ä¸æ­£ç¢º

**ç—‡ç‹€**ï¼š
- Paddle Overlay é¡¯ç¤ºçš„èªè¨€ä¸æ˜¯é æœŸçš„èªè¨€

**è§£æ±ºæ–¹æ³•**ï¼š

å¯ä»¥åœ¨åˆå§‹åŒ–æ™‚è¨­å®šèªè¨€ï¼š

```typescript
Paddle.Initialize({ 
  token: 'ä½ çš„Token',
  locale: 'zh-TW'  // ç¹é«”ä¸­æ–‡
});
```

æ”¯æ´çš„èªè¨€ä»£ç¢¼ï¼š
- `en`ï¼šè‹±æ–‡
- `zh-CN`ï¼šç°¡é«”ä¸­æ–‡
- `zh-TW`ï¼šç¹é«”ä¸­æ–‡
- `ja`ï¼šæ—¥æ–‡
- `ko`ï¼šéŸ“æ–‡

---

## 2ï¸âƒ£ HTTP éŒ¯èª¤ç¢¼å•é¡Œ

### Q4ï¼šå‡ºç¾ 403 Forbidden éŒ¯èª¤

**ç—‡ç‹€**ï¼š
- Network ä¸­çœ‹åˆ° `transaction-checkout` è«‹æ±‚å›å‚³ 403
- Console é¡¯ç¤ºæ¬Šé™ç›¸é—œéŒ¯èª¤

**å¯èƒ½åŸå› **ï¼š

| åŸå›  | ç’°å¢ƒ | æª¢æŸ¥é …ç›® |
|------|------|---------|
| Token æœªæ­£ç¢ºè¨­ç½® | All | æª¢æŸ¥ `Paddle.Initialize({ token: '...' })` |
| Domain æœªæ ¸å‡† | Production | æª¢æŸ¥ Domain Approval ç‹€æ…‹ |
| Price ID ä¸å±¬æ–¼è©²å¸³è™Ÿ | All | ç¢ºèª Price ID ä¾†è‡ªæ­£ç¢ºçš„ Paddle å¸³è™Ÿ |

**è§£æ±ºæ–¹æ³•**ï¼š

1. **Sandbox ç’°å¢ƒ**ï¼š
   - ç¢ºèªä½¿ç”¨ `test_` é–‹é ­çš„ Token
   - ç¢ºèª Price ID ä¾†è‡ª Sandbox Catalog

2. **Production ç’°å¢ƒ**ï¼š
   - ç¢ºèªä½¿ç”¨ `live_` é–‹é ­çš„ Token
   - ç¢ºèª Domain Approval å·²é€šé
   - ç¢ºèª Price ID ä¾†è‡ª Production Catalog

---

### Q5ï¼šå‡ºç¾ 400 Bad Request éŒ¯èª¤

**ç—‡ç‹€**ï¼š
- è«‹æ±‚è¢«æ‹’çµ•ï¼Œå›å‚³ 400 éŒ¯èª¤

**å¯èƒ½åŸå› **ï¼š
- åƒæ•¸æ ¼å¼éŒ¯èª¤
- ç¼ºå°‘å¿…è¦åƒæ•¸

**è§£æ±ºæ–¹æ³•**ï¼š

æª¢æŸ¥ `Checkout.open()` çš„åƒæ•¸æ ¼å¼ï¼š

```typescript
// âœ… æ­£ç¢º
Paddle.Checkout.open({
  items: [
    { 
      priceId: 'pri_...', 
      quantity: 1 
    }
  ]
});

// âŒ éŒ¯èª¤ï¼ˆç¼ºå°‘ items é™£åˆ—ï¼‰
Paddle.Checkout.open({
  priceId: 'pri_...'
});
```

---

## 3ï¸âƒ£ Webhook å•é¡Œ

### Q6ï¼šWebhook æ”¶ä¸åˆ°äº‹ä»¶

**ç—‡ç‹€**ï¼š
- Paddle Simulator ç™¼é€æ¸¬è©¦ï¼Œä½†ä¼ºæœå™¨æ²’æœ‰æ”¶åˆ°

**æª¢æŸ¥æ¸…å–®**ï¼š

- [ ] Webhook URL æ˜¯å¦æ­£ç¢ºï¼ˆåŒ…å« `/api/webhook`ï¼‰
- [ ] ä¼ºæœå™¨æ˜¯å¦æ­£åœ¨åŸ·è¡Œï¼ˆ`npm run dev`ï¼‰
- [ ] Tunnel å·¥å…·æ˜¯å¦æ­£åœ¨åŸ·è¡Œï¼ˆlocaltunnel / ngrokï¼‰
- [ ] Tunnel URL æ˜¯å¦å·²éæœŸï¼ˆlocaltunnel æœƒå®šæœŸæ›´æ›ï¼‰
- [ ] Webhook API æ˜¯å¦æ­£ç¢ºå›å‚³ 200 ç‹€æ…‹ç¢¼

**æ‰‹å‹•æ¸¬è©¦ Webhook**ï¼š

åœ¨çµ‚ç«¯æ©ŸåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤æ¸¬è©¦æœ¬æ©Ÿ APIï¼š

```bash
# Windows PowerShell
Invoke-WebRequest -Uri http://localhost:3000/api/webhook -Method POST -ContentType "application/json" -Body '{"alert_name":"subscription_created","test":true}'

# macOS / Linux
curl -X POST http://localhost:3000/api/webhook \
  -H "Content-Type: application/json" \
  -d '{"alert_name":"subscription_created","test":true}'
```

æ‡‰è©²å›å‚³ï¼š`{"success":true}`

---

### Q7ï¼šWebhook ç°½ç« é©—è­‰å¤±æ•—

**ç—‡ç‹€**ï¼š
- Webhook æ”¶åˆ°è«‹æ±‚ï¼Œä½†ç°½ç« é©—è­‰å¤±æ•—

**å¯èƒ½åŸå› **ï¼š
- Webhook Secret è¨­ç½®éŒ¯èª¤
- ç°½ç« é©—è­‰é‚è¼¯æœ‰èª¤

**è§£æ±ºæ–¹æ³•**ï¼š

1. **ç¢ºèª Webhook Secret æ­£ç¢º**ï¼š
   ```env
   PADDLE_WEBHOOK_SECRET=ä½ å¾Dashboardå–å¾—çš„Secret
   ```

2. **åƒè€ƒ Paddle å®˜æ–¹æ–‡ä»¶**ï¼š
   https://developer.paddle.com/webhooks/signature-verification

3. **é–‹ç™¼éšæ®µå¯æš«æ™‚è·³éé©—è­‰**ï¼ˆåƒ…é™ Sandboxï¼‰ï¼š
   ```typescript
   // âš ï¸ åƒ…ä¾›é–‹ç™¼æ¸¬è©¦ï¼Œç”Ÿç”¢ç’°å¢ƒå¿…é ˆé©—è­‰ï¼
   if (process.env.NODE_ENV === 'development') {
     // è·³éé©—è­‰
   } else {
     // é©—è­‰ç°½ç« 
   }
   ```

---

### Q8ï¼šWebhook é‡è¤‡æ¥æ”¶

**ç—‡ç‹€**ï¼š
- åŒä¸€å€‹äº‹ä»¶æ”¶åˆ°å¤šæ¬¡

**åŸå› **ï¼š
- Paddle æœƒè‡ªå‹•é‡è©¦å¤±æ•—çš„ Webhook
- å¦‚æœä½ çš„ API å›æ‡‰æ™‚é–“éé•·æˆ–å›å‚³é 200 ç‹€æ…‹ç¢¼ï¼ŒPaddle æœƒé‡è©¦

**è§£æ±ºæ–¹æ³•**ï¼š

å¯¦ä½œå†ªç­‰æ€§è™•ç†ï¼š

```typescript
// ä½¿ç”¨è³‡æ–™åº«è¨˜éŒ„å·²è™•ç†çš„äº‹ä»¶ ID
const eventId = body.event_id || body.p_signature;

// æª¢æŸ¥æ˜¯å¦å·²è™•ç†é
const alreadyProcessed = await db.webhookEvents.findOne({ eventId });

if (alreadyProcessed) {
  // å·²è™•ç†éï¼Œç›´æ¥å›å‚³æˆåŠŸ
  return NextResponse.json({ success: true });
}

// è™•ç†äº‹ä»¶...

// è¨˜éŒ„ç‚ºå·²è™•ç†
await db.webhookEvents.create({ eventId, processedAt: new Date() });

return NextResponse.json({ success: true });
```

---

## 4ï¸âƒ£ ç’°å¢ƒåˆ‡æ›å•é¡Œ

### Q9ï¼šåˆ‡æ›åˆ° Production å¾Œç„¡æ³•çµå¸³

**ç—‡ç‹€**ï¼š
- Sandbox æ­£å¸¸ï¼Œä½†åˆ‡æ›åˆ° Production å¾Œå¤±æ•—

**æª¢æŸ¥æ¸…å–®**ï¼š

- [ ] **Token å·²æ›´æ›**ï¼šå¾ `test_` æ”¹ç‚º `live_`
- [ ] **Price ID å·²æ›´æ›**ï¼šä½¿ç”¨ Production ç’°å¢ƒå»ºç«‹çš„ Price
- [ ] **Domain Approval å·²é€šé**ï¼šProduction ç’°å¢ƒå¿…é ˆ
- [ ] **ç’°å¢ƒè¨­å®šå·²ç§»é™¤**ï¼šä¸è¦å†å‘¼å« `Paddle.Environment.set('sandbox')`
- [ ] **é–‹ç™¼ä¼ºæœå™¨å·²é‡å•Ÿ**ï¼šä¿®æ”¹ `.env.local` å¾Œå¿…é ˆé‡å•Ÿ

**é€æ­¥æª¢æŸ¥**ï¼š

1. æª¢æŸ¥ç’°å¢ƒè®Šæ•¸ï¼š
   ```env
   NEXT_PUBLIC_PADDLE_ENV=production
   NEXT_PUBLIC_PADDLE_CLIENT_TOKEN=live_...
   NEXT_PUBLIC_PADDLE_PRICE_ID=pri_...(æ­£å¼ç’°å¢ƒçš„ID)
   ```

2. æª¢æŸ¥ç¨‹å¼ç¢¼ä¸­æ˜¯å¦æœ‰ç¡¬ç·¨ç¢¼çš„ Sandbox å€¼

3. æ¸…é™¤ç€è¦½å™¨å¿«å–å¾Œé‡æ–°æ¸¬è©¦

---

### Q10ï¼šæ¸¬è©¦å¡è™Ÿåœ¨ Production ç„¡æ³•ä½¿ç”¨

**ç—‡ç‹€**ï¼š
- ä½¿ç”¨ `4242 4242 4242 4242` ä»˜æ¬¾å¤±æ•—

**åŸå› **ï¼š
- Production ç’°å¢ƒä¸æ¥å—æ¸¬è©¦å¡è™Ÿ

**è§£æ±ºæ–¹æ³•**ï¼š

1. **ä½¿ç”¨çœŸå¯¦ä¿¡ç”¨å¡**é€²è¡Œå°é¡æ¸¬è©¦ï¼ˆä¾‹å¦‚ $0.50ï¼‰

2. **æ¸¬è©¦å®Œæˆå¾Œç”³è«‹é€€æ¬¾**ï¼š
   - Paddle Dashboard â†’ Transactions
   - æ‰¾åˆ°è©²ç­†äº¤æ˜“
   - é»æ“Š Refund

---

## 5ï¸âƒ£ ä»˜æ¬¾å¤±æ•—å•é¡Œ

### Q11ï¼šç”¨æˆ¶å›å ±ä»˜æ¬¾å¤±æ•—

**å¯èƒ½åŸå› **ï¼š

| åŸå›  | æª¢æŸ¥æ–¹å¼ |
|------|---------|
| å¡ç‰‡é¤˜é¡ä¸è¶³ | è«‹ç”¨æˆ¶æª¢æŸ¥å¡ç‰‡ |
| å¡ç‰‡è¢«éŠ€è¡Œæ‹’çµ• | è«‹ç”¨æˆ¶è¯çµ¡ç™¼å¡éŠ€è¡Œ |
| 3DS é©—è­‰å¤±æ•— | è«‹ç”¨æˆ¶å®Œæˆ 3DS é©—è­‰ |
| ç¶²è·¯å•é¡Œ | è«‹ç”¨æˆ¶é‡è©¦ |
| Paddle ç³»çµ±å•é¡Œ | æª¢æŸ¥ Paddle Status Page |

**è§£æ±ºæ­¥é©Ÿ**ï¼š

1. **åœ¨ Paddle Dashboard æŸ¥è©¢äº¤æ˜“è¨˜éŒ„**ï¼š
   - Transactions â†’ æœå°‹ç”¨æˆ¶éƒµç®±
   - æŸ¥çœ‹å¤±æ•—åŸå› 

2. **å¸¸è¦‹æ‹’çµ•åŸå› **ï¼š
   - `insufficient_funds`ï¼šé¤˜é¡ä¸è¶³
   - `card_declined`ï¼šå¡ç‰‡è¢«æ‹’
   - `authentication_failed`ï¼š3DS é©—è­‰å¤±æ•—

3. **å»ºè­°ç”¨æˆ¶**ï¼š
   - æ›ä¸€å¼µå¡ç‰‡è©¦è©¦
   - è¯çµ¡ç™¼å¡éŠ€è¡Œç¢ºèª

---

## 6ï¸âƒ£ é™¤éŒ¯å·¥å…·èˆ‡æŠ€å·§

### é™¤éŒ¯æŠ€å·§ 1ï¼šä½¿ç”¨ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·

**Console æ¨™ç±¤**ï¼š
- æŸ¥çœ‹ JavaScript éŒ¯èª¤
- æ¸¬è©¦ Paddle ç‰©ä»¶

**Network æ¨™ç±¤**ï¼š
- æŸ¥çœ‹ API è«‹æ±‚
- æª¢æŸ¥å›æ‡‰ç‹€æ…‹ç¢¼å’Œå…§å®¹

**Application æ¨™ç±¤**ï¼š
- æŸ¥çœ‹ Local Storage
- æ¸…é™¤ Cookie

---

### é™¤éŒ¯æŠ€å·§ 2ï¼šå•Ÿç”¨è©³ç´°æ—¥èªŒ

åœ¨ç¨‹å¼ç¢¼ä¸­åŠ å…¥è©³ç´°çš„ console.logï¼š

```typescript
// PaddleLoader.tsx
onLoad={() => {
  console.log('ğŸ”§ Paddle script loaded');
  console.log('ğŸ”§ Token:', process.env.NEXT_PUBLIC_PADDLE_CLIENT_TOKEN);
  
  (window as any).Paddle?.Environment?.set('sandbox');
  console.log('ğŸ”§ Environment set to sandbox');
  
  (window as any).Paddle?.Initialize?.({ token: '...' });
  console.log('ğŸ”§ Paddle initialized');
}}
```

---

### é™¤éŒ¯æŠ€å·§ 3ï¼šæ¸¬è©¦ Paddle æ•´åˆ

åœ¨ Console æ‰‹å‹•æ¸¬è©¦ï¼š

```javascript
// 1. æª¢æŸ¥ Paddle ç‰©ä»¶æ˜¯å¦å­˜åœ¨
window.Paddle

// 2. æ‰‹å‹•è§¸ç™¼çµå¸³
window.Paddle.Checkout.open({
  items: [{ priceId: 'pri_...', quantity: 1 }]
})

// 3. æª¢æŸ¥ç’°å¢ƒè¨­å®š
window.Paddle.Environment
```

---

### é™¤éŒ¯æŠ€å·§ 4ï¼šä½¿ç”¨ Paddle å®˜æ–¹æ¸¬è©¦å·¥å…·

**Paddle Dashboard çš„æ¸¬è©¦åŠŸèƒ½**ï¼š

1. **Webhook Simulator**ï¼š
   - Developer Tools â†’ Notifications â†’ Simulations
   - æ¸¬è©¦ Webhook æ˜¯å¦æ­£å¸¸æ¥æ”¶

2. **Transaction Logs**ï¼š
   - Transactions é é¢
   - æŸ¥çœ‹æ‰€æœ‰äº¤æ˜“è¨˜éŒ„å’Œå¤±æ•—åŸå› 

---

## ğŸ“ éœ€è¦æ›´å¤šå”åŠ©ï¼Ÿ

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½ç„¡æ³•è§£æ±ºä½ çš„å•é¡Œï¼š

1. **æŸ¥é–± Paddle å®˜æ–¹æ–‡æª”**ï¼š
   - https://developer.paddle.com/

2. **è¯çµ¡ Paddle æ”¯æ´**ï¼š
   - https://paddle.com/support

3. **æäº¤ Issue åˆ°æœ¬å°ˆæ¡ˆ**ï¼š
   - https://github.com/your-username/open-paddle-reference-guides/issues

4. **åŠ å…¥è¨è«–å€**ï¼š
   - https://github.com/your-username/open-paddle-reference-guides/discussions

---

## ğŸ”— ç›¸é—œæ–‡æª”

- [01-ç”¢å“æ–°å¢æŒ‡å—](./01-ç”¢å“æ–°å¢æŒ‡å—.md)
- [02-Paddleå¹³å°åƒæ•¸èªªæ˜](./02-Paddleå¹³å°åƒæ•¸èªªæ˜.md)
- [03-æ²™ç›’è½‰ç”Ÿç”¢ç’°å¢ƒæŒ‡å—](./03-æ²™ç›’è½‰ç”Ÿç”¢ç’°å¢ƒæŒ‡å—.md)
- [05-Webhookäº‹ä»¶è™•ç†æŒ‡å—](./05-Webhookäº‹ä»¶è™•ç†æŒ‡å—.md)

---

**æ–‡æª”ç‰ˆæœ¬**ï¼šv1.0.0  
**æœ€å¾Œæ›´æ–°**ï¼š2025-10-01  
**å¯¦æ¸¬æ—¥æœŸ**ï¼š2025-09-30

